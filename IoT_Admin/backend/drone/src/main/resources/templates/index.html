<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="title" content="IoT ê´€ì œ ì‹œìŠ¤í…œ" />
    <meta property="article:author" content="GATSBY" />
    <meta property="og:type" content="website" />
    <title>IoT ê´€ì œ ì‹œìŠ¤í…œ</title>
    <!-- íŒŒë¹„ì½˜ -->
    <!-- íŒŒë¹„ì½˜ ì‚¬ì§„ì€ .icoë¡œ ë³€í™˜ì„ í•´ì¤˜ì•¼ í•œë‹¤! -->
    <link rel="shortcut icon" href="images/favicon.ico" />
    <!-- index css -->
    <link rel="stylesheet" href="css/index.css" />
  </head>
  <body>
    <div class="container">
      <div class="nav">
        <!-- react, angular ê°™ì€ í”„ë¡ íŠ¸ í”„ë ˆì„ì›Œí¬ì—ì„œëŠ” onclickì„ ì§€í–¥ -->
       <!--  <div class="item" onclick="getDrone()">
          <div class="drone-image">
            <img src="images/drone_1.jpg" />
            ë“œë¡ (IoT) ê³ ìœ ì•„ì´ë””(*UUID)
            <h3>KAZA-556699</h3>
            ë“œë¡  ë°°í„°ë¦¬ ì •ë³´
            <p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>88%</span></p>
          </div>
        </div>
        <div class="item" onclick="getDrone()">
          <div class="drone-image">
            <img src="images/drone_2.jpg" />
            ë“œë¡ (IoT) ê³ ìœ ì•„ì´ë””(*UUID)
            <h3>ADCC-117700</h3>
            ë“œë¡  ë°°í„°ë¦¬ ì •ë³´
            <p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>70%</span></p>
          </div>
        </div>
        <div class="item" onclick="getDrone()">
          <div class="drone-image">
            <img src="images/drone_3.jpg" />
            ë“œë¡ (IoT) ê³ ìœ ì•„ì´ë””(*UUID)
            <h3>ZOOP-411133</h3>
            ë“œë¡  ë°°í„°ë¦¬ ì •ë³´
            <p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>83%</span></p>
          </div>
        </div>
        <div class="item" onclick="getDrone()">
          <div class="drone-image">
            <img src="images/drone_4.jpg" />
            ë“œë¡ (IoT) ê³ ìœ ì•„ì´ë””(*UUID)
            <h3>SAMA-931207</h3>
            ë“œë¡  ë°°í„°ë¦¬ ì •ë³´
            <p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>99%</span></p>
          </div>
        </div>
        <div class="item" onclick="getDrone()">
          <div class="drone-image">
            <img src="images/drone_5.jpg" />
            ë“œë¡ (IoT) ê³ ìœ ì•„ì´ë””(*UUID)
            <h3>AJJK-581238</h3>
            ë“œë¡  ë°°í„°ë¦¬ ì •ë³´
            <p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>89%</span></p>
          </div>
        </div> -->
      </div>
      <div id="kakao-map" class="map">
        <div class="drone-init">
          <a href="#">
            <span>ë“œë¡  ìœ„ì¹˜ ìƒˆë¡œê³ ì¹¨</span>
          </a>
        </div>
      </div>
    </div>
  </body>
  <!-- ì¹´ì¹´ì˜¤ ë§µ ì‚¬ìš©ì„ ìœ„í•œ JS -->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8d2a405849f0df8e86396609bab2ffbe"></script>
  <script
        src="https://code.jquery.com/jquery-3.6.1.js"
        integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI="
        crossorigin="anonymous"></script>
  <script>
    initMap();
    getDrones();
    //ë“±ë¡ëœ ë“œë¡  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    //Jquery AJAXëŠ” Spring ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë˜, ì „ìì •ë¶€í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ë˜‘ê°™ë‹¤.
    //íšŒì‚¬ì—ì„œ JSPë¥¼ ì‚¬ìš©í•˜ë˜ ë­˜ ì‚¬ìš©í•˜ë˜ ë¦¬ì•¡íŠ¸, ë·°, ì•µê·¤ëŸ¬ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ë©´, ì•„ë˜ ë¡œì§ì€ ë¬´ì¡°ê±´ ì‚¬ìš©í•œë‹¤.
    function getDrones(){
    	$.ajax({
			url : '/drones',
      	  	type : 'GET',
      	  	dataType : 'json',
      	  	success : function(response){
      		  var html = "";
      		  
      		  //uuid, ëª¨ë¸ì´ë¦„, ë°°í„°ë¦¬
			  for(var i=0; i<response.length; i++){
				  //ì´ë¯¸ì§€ëŠ” ì´ë¯¸ì§€ì„œë²„ì— ê´€ë¦¬ë¥¼ í•˜ê³  ì´ë¯¸ì§€ ê²½ë¡œë¥¼ dbì— ì €ì¥í•œë‹¤.
				  html += '<div class = "item" onclick="getDrone('+response[i].uuid+')"><div class="drone-image"><img src="images/drone_'+(i+1)+'.jpg" /><h3>'+ response[i].modelName+'</h3><p>ë°°í„°ë¦¬ ì”ëŸ‰ : <span>'+response[i].battery+'%</span></p></div></div>';
			  }      		  
      		  $('.nav').append(html);
      	  	}
    	});
    }
    
    //ë§µ ì´ˆê¸°í™” í•¨ìˆ˜
    function initMap() {
      var mapContainer = document.getElementById('kakao-map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
        mapOption = {
          center: new kakao.maps.LatLng(36.3286904, 127.4229992), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 8, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };
      var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      
      $.ajax({
    	  url : '/drones',
    	  type : 'GET',
    	  dataType : 'json',
    	  success : function(response){
    		  console.log(response);
    		  var positions = [];
    		  for(var i=0; i<response.length; i++){
    			  
    			  var jsonData = {
    					  content: '<div style="margin : 10px;">'+ response[i].modelName +'</div>',
    					  latlng: new kakao.maps.LatLng(Number(response[i].latitude), Number(response[i].longitude)),
    			  };
    			  positions[i] = jsonData;
    		  }

    		      // ë§ˆì»¤ ì—¬ëŸ¬ê°œ ìƒì„±í•˜ê¸°
    		      for (var i = 0; i < positions.length; i++) {
    		        // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    		        var marker = new kakao.maps.Marker({
    		          map: map,
    		          position: positions[i].latlng,
    		        });

    		        // ì¸í¬ ìœˆë„ìš° ìƒì„±í•˜ê¸°
    		        var infowindow = new kakao.maps.InfoWindow({
    		          content: positions[i].content,
    		        });

    		        // ì´ë²¤íŠ¸ ìƒì„±í•˜ê¸°
    		        // Listenerë€ ì´ë²¤íŠ¸ë¥¼ ì¤€ë¹„í•˜ëŠ”ê±¸ ì˜ë¯¸
    		        kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
    		        kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
    		      }
    	  }
      });
      
      
    }
    /*
    ***ìë°” ìŠ¤í¬ë¦½íŠ¸ ë©”ì†Œë“œ íŠ¹ì§•ğŸ’—

    function í•¨ìˆ˜ì´ë¦„(ì‚¬ê³¼) {
	
    }
    1. ë¦¬í„´íƒ€ì…ì´ ì—†ë‹¤.
    2. íŒŒë¼ë¯¸í„° íƒ€ì…ì´ ì—†ë‹¤.
    3. ë¦¬í„´ì— í•¨ìˆ˜ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŒ.(í´ë¡œì €)
    */

    // ì¸í¬ ìœˆë„ìš° ìƒì„±
    function makeOverListener(map, marker, infowindow) {
      return function () {
        infowindow.open(map, marker);
      };
    }
    // ì¸í¬ ìœˆë„ìš° ë‹«ê¸°
    function makeOutListener(infowindow) {
      return function () {
        infowindow.close();
      };
    }

    //ë“œë¡  ìƒì„¸í˜ì´ì§€ ì´ë™
    function getDrone(uuid) {
      	location.href = '/drone/detail/'+uuid; 
    }
  </script>
</html>
